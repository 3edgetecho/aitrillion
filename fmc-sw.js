var ENV='development';if(ENV=='development'){var MESSAGING_SENDER_ID='558253539143';var PUSH_TRACKING_URL='https://d22qm99o9uiw2g.cloudfront.net'}else if(ENV=='production'){var MESSAGING_SENDER_ID='1046830746641';var PUSH_TRACKING_URL='https://push-t.aitrillion.com'}else if(ENV=='staging'){var MESSAGING_SENDER_ID='438734784637';var PUSH_TRACKING_URL='https://df2d8si2nqspi.cloudfront.net'}
self.addEventListener('notificationclick',function(event,listener){ if(event.action){var click=event.action}else if(event.notification.data&&event.notification.data.notification&&event.notification.data.notification.click_action){var click=event.notification.data.notification.click_action}else if(event.notification.data.FCM_MSG&&event.notification.data.FCM_MSG.notification.click_action){var click=event.notification.data.FCM_MSG.notification.click_action}
click = decodeURI(click); var encodeclickurl=encodeURI(click);clients.openWindow(encodeclickurl);var click_action=click;var parsedUrl=new URL(click_action);var shop_name=parsedUrl.searchParams.get("shop_name");var pushevent=parsedUrl.searchParams.get("pushevent");var push_type=parsedUrl.searchParams.get("push_type");if(!pushevent){pushevent='Main'}
var id=parsedUrl.searchParams.get("reportid");event.waitUntil(fetch(PUSH_TRACKING_URL+'/wpi.html?action=click&id='+id+'&pushevent='+pushevent+'&shop_name='+shop_name+'&push_type='+push_type,{method:'GET',mode:'cors'}).then(function(response){}).then(function(data){}));event.preventDefault();event.notification.close()})
self.addEventListener('push',function(event,listener){console.log(event);var str=event.data.text();var obj=JSON.parse(str);var click_action=obj.notification.click_action;var parsedUrl=new URL(click_action);var shop_name=parsedUrl.searchParams.get("shop_name");var id=parsedUrl.searchParams.get("reportid");var push_type=parsedUrl.searchParams.get("push_type");event.waitUntil(fetch(PUSH_TRACKING_URL+'/wpi.html?action=impression&id='+id+'&shop_name='+shop_name+'&push_type='+push_type,{method:'GET',mode:'cors'}).then(function(response){}).then(function(data){}))})
importScripts('https://www.gstatic.com/firebasejs/4.8.1/firebase-app.js');importScripts('https://www.gstatic.com/firebasejs/4.8.1/firebase-messaging.js');firebase.initializeApp({'messagingSenderId':MESSAGING_SENDER_ID});const messaging=firebase.messaging();self.addEventListener("notificationclose",function(event){}) 